rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    match /{allPaths=**} {
      // Only allow users to access files in a folder named after their UID
      allow read, write: if request.auth != null && resource != null && resource.name.matches('/b/' + bucket + '/o/' + request.auth.uid + '/.*');
      // Allow upload to their own folder
      allow write: if request.auth != null && request.resource.name.matches('/b/' + bucket + '/o/' + request.auth.uid + '/.*');
      // Allow read from their own folder
      allow read: if request.auth != null && resource != null && resource.name.matches('/b/' + bucket + '/o/' + request.auth.uid + '/.*');
    }
  }
}